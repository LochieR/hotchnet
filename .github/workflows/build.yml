name: Build for Raspberry Pi

on:
    push:
        branches:
            - main

permissions:
    contents: write

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v3

        - name: Get SHA variable
          id: vars
          run: echo "SHORT_SHA=${GITHUB_SHA::7}" >> $GITHUB_ENV

        - name: Setup .NET
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: '8.0.x'

        - name: Publish for linux-arm
          run: |
            dotnet publish -c Release -r linux-arm --self-contained true /p:PublishTrimmed=false -o ./publish
            zip -r publish.zip publish

        - name: Create release
          uses: softprops/action-gh-release@v2
          with:
            tag_name: ${{ env.SHORT_SHA }}
            name: Build ${{ env.SHORT_SHA }}
            files: |
                publish.zip
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
